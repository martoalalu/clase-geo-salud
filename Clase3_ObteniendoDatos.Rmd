---
title: "Obteniendo Datos"
author: "Elian"
date: "16/7/2021"
output: html_document
editor_options: 
  chunk_output_type: console
---



# Descargando archivos de portales web

Hasta el momento solo trabajamos con archivos geojson o CSV que se encontraban cuidadosamente seleccionados y ubicados en repositorios personales... pero ya sabemos que muchas veces los datos están un poco desordenados o en distintos formatos. 

Entonces surge la pregunta: *¿cómo es el proceso de "conseguir" nuestros propios datos en la vida real?*

Hoy en día tenemos muchos portales de datos abiertos que nos permiten obtener información georeferenciada. Algunos de los portales que hemos mencionado anteriormente y de los que sacamos algunos de los datos con los que hemos trabajado son:

* [**Instituto Geográfico Nacional**](https://www.ign.gob.ar/NuestrasActividades/InformacionGeoespacial/CapasSIG)
* [**BA Data**](http://data.buenosaires.gob.ar/)
* [**Datos Argentina**](http://datos.gob.ar/)

Si hacemos un poquito de memoria, en la primer clase mencionamos que existen múltiples formatos de archivo que almacenan información geográfica. Por ejemplo:

* *SHP*
* *geojson*
* *KML*
* *CSV*

*SHP*

El formato ESRI Shapefile (SHP) es un formato de archivo propietario de datos espaciales desarrollado por la compañía ESRI, quien crea y comercializa software para Sistemas de Información Geográfica como Arc/Info o ArcGIS. Actualmente es un formato bastante estandarizado para el intercambio de información geográfica, por lo tanto puede ser bastante común que se encuentren con este tipo de archivos.

Habitualmente van a encontrar este tipo de archivos comprimidos en un .zip, donde pueden tener al menos 3 componentes: 

* *shp* - es el archivo que almacena las entidades geométricas de los objetos.
* *shx* - es el archivo que almacena el índice de las entidades geométricas.
* *dbf* - es la base de datos, en formato dBASE, donde se almacena la información de los atributos de los objetos.

Les proponemos realizar un pequeño ejemplo práctico donde obtendremos los datos por cuenta propia en formato SHP. 

Para comenzar, nos dirigimos a la página de [**BA Data**](http://data.buenosaires.gob.ar/), donde nos encontraremos con una gran cantidad de sets de datos abiertos... muchos de ellos son geográficos. Vamos a descargar trabajar con datos de movilidad de CABA. Les dejamos los links a continuación:

* [**Base de datos de estaciones**](https://cdn.buenosaires.gob.ar/datosabiertos/datasets/subte-estaciones/estaciones-de-subte-zip.zip)
* [**Base de datos de lineas**](https://cdn.buenosaires.gob.ar/datosabiertos/datasets/subte-estaciones/lineas-de-subte-zip.zip)

```{r, echo=TRUE, message=FALSE}
library (sf)
library (tidyverse)
```

*¿Pero entonces, cómo abrimos estos archivos?*

Primero tenemos que descomprimir los archivos en un directorio en el cuál tengamos acceso desde nuestra PC. Luego podemos utilizar el tradicional read_sf que venimos utilizando para abrir nuestros archivos geográficos sobre el archivo con extensión *.shp*.  

```{r}
setwd(getwd())
estaciones <- read_sf ("clase-geo-salud/data/estaciones-de-subte-zip/estaciones-de-subte.shp") #deben colocar el directorio en el cual descomprimieron el archivo

#vamos a explorar el objeto
head(estaciones)
summary(estaciones)

#qué tipo de objeto es?
class(estaciones)
```

Esto tiene buena pinta! Tenemos un objeto con formato SF sobre el cuál ya sabemos trabajar! Vamos a hacer un mapa.

```{r}
ggplot (estaciones) +
    geom_sf()
```

El objeto *estaciones* contiene las ubicaciones de las estaciones de subte de CABA.

Veamos que sucede con el segundo objeto que descargamos. Ya sabemos como leerlo:


```{r}
lineas <- read_sf("clase-geo-salud/data/lineas-de-subte-zip/lineas-subte.shp") #deben colocar el directorio en el cual descomprimieron el archivo

#vamos a explorar el objeto
head(lineas)
summary(lineas)

#qué tipo de objeto es?
class(lineas)
```

Vamos a hacer un mapa!

```{r}
ggplot (lineas) +
  geom_sf()
```

El gráfico nos muestra un objeto geométrico diferente! Ahora tenemos líneas que representan los recorridos de subte. Y si combinamos los datos?

```{r}
ggplot() +
    geom_sf(data = lineas, color = "red") +
    geom_sf(data = estaciones, color = "orange") +
    labs(title = "Estaciones de subte y recorrido de las líneas",
         subtitle = "CABA")
```

Okay, y si a esto lo ubicamos en contexto?

```{r}
#vamos a buscar uno de los mapas de CABA que trabajamos en clases anteriores. Noten que está en formato geojson.
caba <- read_sf("https://raw.githubusercontent.com/martoalalu/clase-geo-salud/clase-2021/data/caba.geojson")


ggplot() +
    geom_sf(data = caba) +
    geom_sf(data = lineas, color = "red") +
    geom_sf(data = estaciones, color = "orange") +
    labs(title = "Estaciones de subte y recorrido de las líneas",
         subtitle = "CABA")
```

Si prestan atención, el mapa de CABA fue dibujado a partir de un archivo geojson y pudimos cargarlo sin problemas! Es decir que una vez que creamos un objeto SF, podemos manipularlo de la misma forma que estuvimos trabajando en las clases anteriores, sin importar el formato de origen del archivo.


*Ahora veamos como cargar un archivo json de IGN*

El IGN pone a disposición una serie de capas de información geoespacial para su descarga. Esta información es consistente con el Catálogo de Objetos Geográficos del Organismo y forma parte de la Base de Datos Geoespacial Institucional. Todos los datos se encuentran expresados en coordenadas geodésicas, utilizando el Sistema de Referencia WGS 84 (Código EPSG:4326). 

A continuación les brindamos el link de acceso al archivo con el que trabajaremos:

* [**Base de departamentos**](https://dnsg.ign.gob.ar/apps/api/v1/capas-sig/Geodesia+y+demarcaci%C3%B3n/L%C3%ADmites/departamento/json)

Una vez descargado el archivo, descomprimimos el ZIP. Adivinen qué podemos utilizar para abrir el archivo? read_sf!

```{r}
departamentos <- read_sf ("clase-geo-salud/data/departamento.json")#deben colocar el directorio en el cual descomprimieron el archivo

#vamos a explorar el objeto
head(departamentos)
summary (departamentos)

#qué tipo de objeto es?
class(departamentos)
```

Vamos a hacer un mapa.

```{r}
ggplot (departamentos) +
  geom_sf()
```


